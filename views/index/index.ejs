<div>
  <h1>Ask questions</h1>

  <label>
    Room: <input type="number" name="room" id="room">
  </label>

  <button class="btn btn-primary joinRoom">Join room!</button>

  <label>
    Question text: <input type="text" name="question" id="question">
  </label>

  <button class="btn btn-primary addQuestion">Ask!</button>

  <h2>List of questions</h2>

  <ul class="listOfQuestions">
    
  </ul>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  let socket;
  let pitanja = [];

  $(document).ready(function () {
    socket = io('http://localhost:3000');
    
    socket.on('joined_room', (data) => {
      localStorage.setItem('my_room', data.room);
      alert(data.msg);
    });
    
    socket.on('msg', ({ question, id }) => {
      //pitanja.push({ id, question, odobrenja: 0 });
      $(".listOfQuestions").append("<li data-o='0' class='" + id + "'>" + question + `<button onclick='odobri("${question}", "${id}")'>Odobri</button></li>`);
    });

    socket.on('odobrenja', function ({ id, br_od }) {
      const odo = parseInt($(`.${id}`).attr("data-o")) + 1;
      $(`.${id}`).attr("data-o", br_od);

      let pitanja = $("li");
      console.log(pitanja);
      //pitanja.sort((a,b) => (a.last_nom > b.last_nom) ? 1 : ((b.last_nom > a.last_nom) ? -1 : 0)); 
    });
  });

  function odobri(pitanje, id) {
    console.log(pitanje)
    socket.emit('odobri', {
      pitanje,
      room: localStorage.getItem('my_room')
    });
  }

  $(".addQuestion").click(function () {
    let question = $("#question").val();

    socket.emit('msg', {question, room: localStorage.getItem('my_room')});
  });

  $(".joinRoom").click(function () {
    let roomNumber = $("#room").val();

    socket.emit('join_room', {
      room: roomNumber,
    });
  });
</script>